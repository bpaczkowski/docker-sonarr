#!/usr/bin/nodejs
const exec = require('child_process').exec;

const subDir = '/config/sub-cache';
const pathEnvName = 'sonarr_moviefile_path';

console.log('env: ', JSON.stringify(process.env));

if (!('SUB_LANGUAGES' in process.env) || !('SUB_PROVIDERS' in process.env) || !(pathEnvName in process.env)) {
  return;
}

const languages = process.env.SUB_LANGUAGES.split(',').map(v => '-l ' + v).join(' ');
const providers = process.env.SUB_PROVIDERS.split(',').map(v => '-p ' + v).join(' ');

const cmd = `subliminal --cache-dir ${subDir} download ${languages} ${providers} "${process.env[pathEnvName]}"`;

console.log(`executing: ${cmd}`);

exec(cmd, (err, stdout, stderr) => {
  if (err) {
    return console.log(err);
  }

  if (stdout) {
    console.log(stdout);
  }

  if (stderr) {
    console.log(stderr);
  }
});
